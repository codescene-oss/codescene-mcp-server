# Test runner for Docker variant SSL integration testing
#
# This Dockerfile creates a test container that matches the actual
# MCP Docker deployment. It includes:
# - The same Python environment and dependencies
# - The CodeScene CLI
# - The MCP server code
# - Test scripts
#
# The test runs the MCP server as a subprocess and sends MCP protocol
# requests, verifying SSL works end-to-end.

FROM python:3.13

WORKDIR /app

# Install dependencies
COPY src/requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# Install the CS CLI (same as main Dockerfile)
RUN curl -fsSL https://downloads.codescene.io/enterprise/cli/install-cs-tool.sh | bash -s -- -y
ENV PATH="/root/.local/bin:${PATH}"

# Copy source code
COPY src/ /app/src/

# Copy test script
COPY tests/ssl-integration/test_docker_variant.py /app/test_docker_variant.py

# Set Python path
ENV PYTHONPATH=/app/src

# Run the test script
CMD ["python", "/app/test_docker_variant.py"]
